<head>
    <title>colornames</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }

        h1, div{
            text-align: center;
        }

        #page {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .color {
            display: inline-flex;
            flex-direction: column;
            align-items: center;

            border: 1px solid black;
            margin: 10px;
            padding: 10px;
        }

        .color-square {
            height: 50px;
            width: 50px;
            margin-bottom: 5px;
        }

        .button {
            border: 1px solid black;
            padding: 10px;
        }

        .double-flex {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 20px;
        }

        #color-grid {
            width: 80%;
            border: 1px solid black;
            margin: 10px;
        }

    </style>
    </head>
    
    <body>
        <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
        <script type="text/babel">

            const CATEGORIES = {
                'I': 'mnptCkbdjgfTsShvz',
                'L': 'rlyw',
                'V': 'aeiou',
                'M': 'rl',
                'F': 'mnNptCkbdjgfTsSvz'
            }

            const REWRITES = {
                'C': 'ch',
                'T': 'th',
                'S': 'sh',
                'N': 'ng'
            }

            const SYLLABLES = [
                'IVF', 'IVM', 'IVMF', 
                'LVF', 'LVM', 'LVMF',
                'ILVF', 'ILVM', 'ILVMF'
            ];

            const isVowel = char => ['a', 'e', 'i', 'o', 'u'].some(elem => char === elem);

            const getRandomSyllable = () => {
                let template = SYLLABLES[Math.floor(Math.random() * SYLLABLES.length)];
                return Array.from(template)
                    .map(elem => {
                        let char = CATEGORIES[elem].charAt(Math.floor(Math.random() * CATEGORIES[elem].length));
                        return REWRITES.hasOwnProperty(char) ? REWRITES[char] : char;        
                    })
                    .join('');
            };

            const merge = (syll1, syll2) => {
                let i1 = syll1.length - 1;
                let i2 = 0;
                while(!isVowel(syll1.charAt(i1))){
                    i1--;
                }

                while(!isVowel(syll2.charAt(i2))){
                    i2++;
                }

                if(syll1.length > syll2.length){
                    return syll1.substring(0, i1 + 1) + syll2;
                }

                return syll1 + syll2.substring(i2);
            }

            const getRGB = array => {
                return array.reduce((rgbString, elem) => {
                    let currentString = elem.toString(16);

                    if(currentString.length === 1){
                        currentString = '0' + currentString;
                    }

                    return rgbString + currentString;
                }, '#');
            };

            const getRandomColor = () => [Math.floor(Math.random() * 255), Math.floor(Math.random() * 255), Math.floor(Math.random() * 255)];
                
        class Color extends React.Component {
            constructor(props){
                super(props);
            }

            render(){
                return (<div className='color' onClick={this.props.onClick}>
                    <div className='color-square' style = {{'backgroundColor' : getRGB(this.props.color)}}></div>
                    <div>{this.props.name}</div>
                    <div>{getRGB(this.props.color)}</div>
                </div>);
            }
        }

        const getStartingArray = () => {
            let ret = [];
            
            for(let i = 0; i < 5; i++){
                ret.push({
                    color: getRandomColor(),
                    name: getRandomSyllable()
                });
            }

            return ret;
        }

        class Page extends React.Component {
            constructor(props){
                super(props);

                this.state = {
                    colors: getStartingArray(),
                    mergeColors: []
                }

                this.addColor = this.addColor.bind(this);
                this.addRandomColor = this.addRandomColor.bind(this);
                this.addMergedColor = this.addMergedColor.bind(this);
                this.updateMergeColors = this.updateMergeColors.bind(this);
            }

            addColor(newColor, newName){
                this.setState(state => ({
                    colors: [...state.colors, {
                        color: newColor,
                        name: newName
                    }]
                }));
            }

            addRandomColor(){
                this.addColor(getRandomColor(), getRandomSyllable())
            }

            updateMergeColors(colorObject){
                let t = this;

                return function(){
                    let newMergeColors = [...t.state.mergeColors];

                    if(newMergeColors.length > 0 && newMergeColors[newMergeColors.length - 1].name === colorObject.name){
                        return;
                    }

                    if(newMergeColors.length < 2){
                        newMergeColors.push(colorObject);
                    }
                    else{
                        newMergeColors[0] = newMergeColors[1];
                        newMergeColors[1] = colorObject;
                    }

                    t.setState({
                        mergeColors: newMergeColors
                    });

                    console.log(newMergeColors);
                };
            }

            addMergedColor(){
                if(this.state.mergeColors.length < 2){
                    return;
                }

                let newColor = [];

                for(let i = 0; i < 3; i++){
                    newColor.push(Math.round((this.state.mergeColors[0].color[i] + this.state.mergeColors[1].color[i]) / 2));
                }

                this.addColor(newColor, merge(this.state.mergeColors[0].name, this.state.mergeColors[1].name));
            
                this.setState({
                    mergeColors: []
                });
            }

            render(){
                return (<div id='page'>
                    <h1>color names</h1>  
                    
                    <div className='double-flex'>
                        <div className='button' onClick={this.addRandomColor}>add random color</div>
                        <div className='button' onClick={this.addMergedColor} style={{'color': this.state.mergeColors.length == 2 ? 'black': 'gray'}}>add merged color</div>
                    </div>

                    <div id='color-grid'>
                        {this.state.colors.map(elem => <Color key={elem.name} name={elem.name} color={elem.color} onClick ={this.updateMergeColors(elem)}/>)}
                    </div>

                    <div>colors to merge
                        {this.state.mergeColors.length < 2 && " (select two)"}
                        </div>

                    <div className='double-flex'>
                        {this.state.mergeColors.map(elem => <Color key={elem.name} name={elem.name} color={elem.color}/>)}
                    </div>

                    </div>);          
            }
        }


        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Page/>);
    </script>
    <div id="root"></div>
</body>